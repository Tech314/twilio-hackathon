FROM keymetrics/pm2:10-alpine

# Bundle files
COPY pm2.json .
COPY dist .
COPY node_modules node_modules

ARG APP_ENV
ARG DB_HOST
ARG DB_USER
ARG DB_PASS
ARG DB
ARG TWILIO_ACC_SID
ARG TWILIO_AUTH_TOKEN

# Install app dependencies
ENV NPM_CONFIG_LOGLEVEL warn
ENV NODE_ENV $APP_ENV
ENV HACKATHON_DBHOST $DB_HOST
ENV HACKATHON_DBUSER $DB_USER
ENV HACKATHON_DBPASS $DB_PASS
ENV HACKATHON_DB $DB
ENV TWILIO_ACCOUNT_SID $TWILIO_ACC_SID
ENV TWILIO_AUTH_TOKEN $TWILIO_AUTH_TOKEN

# Expose the listening port
EXPOSE 3123

# Show current folder structure in logs
RUN ls -al

CMD pm2-runtime start pm2.json